var t={334:t=>{function e(t,e=100,i={}){if("function"!=typeof t)throw new TypeError(`Expected the first parameter to be a function, got \`${typeof t}\`.`);if(e<0)throw new RangeError("`wait` must not be negative.");const{immediate:s}="boolean"==typeof i?{immediate:i}:i;let n,r,a,h,o;function l(){const e=n,i=r;return n=void 0,r=void 0,o=t.apply(e,i),o}function u(){const t=Date.now()-h;t<e&&t>=0?a=setTimeout(u,e-t):(a=void 0,s||(o=l()))}const c=function(...t){if(n&&this!==n&&Object.getPrototypeOf(this)===Object.getPrototypeOf(n))throw new Error("Debounced method called with different contexts of the same prototype.");n=this,r=t,h=Date.now();const i=s&&!a;return a||(a=setTimeout(u,e)),i&&(o=l()),o};return Object.defineProperty(c,"isPending",{get:()=>void 0!==a}),c.clear=()=>{a&&(clearTimeout(a),a=void 0)},c.flush=()=>{a&&c.trigger()},c.trigger=()=>{o=l(),c.clear()},c}t.exports.debounce=e,t.exports=e},267:t=>{function e(t,e,i){var s=Math.sqrt,n=Math.pow;this.x1=t,this.x2=e,this.weights=i||{},this.ksubL=this.weights.lightness||1,this.ksubC=this.weights.chroma||1,this.ksubH=this.weights.hue||1,this.deltaLPrime=e.L-t.L,this.LBar=(t.L+e.L)/2,this.C1=s(n(t.A,2)+n(t.B,2)),this.C2=s(n(e.A,2)+n(e.B,2)),this.CBar=(this.C1+this.C2)/2,this.aPrime1=t.A+t.A/2*(1-s(n(this.CBar,7)/(n(this.CBar,7)+n(25,7)))),this.aPrime2=e.A+e.A/2*(1-s(n(this.CBar,7)/(n(this.CBar,7)+n(25,7)))),this.CPrime1=s(n(this.aPrime1,2)+n(t.B,2)),this.CPrime2=s(n(this.aPrime2,2)+n(e.B,2)),this.CBarPrime=(this.CPrime1+this.CPrime2)/2,this.deltaCPrime=this.CPrime2-this.CPrime1,this.SsubL=1+.015*n(this.LBar-50,2)/s(20+n(this.LBar-50,2)),this.SsubC=1+.045*this.CBarPrime,this.hPrime1=0,this.hPrime2=0,this.deltahPrime=0,this.deltaHPrime=0,this.HBarPrime=0,this.T=0,this.SsubH=0,this.RsubT=0}e.prototype.getDeltaE=function(){var t=Math.sqrt,e=Math.sin,i=Math.pow;this.hPrime1=this.gethPrime1(),this.hPrime2=this.gethPrime2(),this.deltahPrime=this.getDeltahPrime(),this.deltaHPrime=2*t(this.CPrime1*this.CPrime2)*e(this.degreesToRadians(this.deltahPrime)/2),this.HBarPrime=this.getHBarPrime(),this.T=this.getT(),this.SsubH=1+.015*this.CBarPrime*this.T,this.RsubT=this.getRsubT();var s=this.deltaLPrime/(this.ksubL*this.SsubL),n=this.deltaCPrime/(this.ksubC*this.SsubC),r=this.deltaHPrime/(this.ksubH*this.SsubH);return t(i(s,2)+i(n,2)+i(r,2)+this.RsubT*n*r)},e.prototype.getRsubT=function(){var t=Math.sin,e=Math.sqrt,i=Math.pow,s=Math.exp;return-2*e(i(this.CBarPrime,7)/(i(this.CBarPrime,7)+i(25,7)))*t(this.degreesToRadians(60*s(-i((this.HBarPrime-275)/25,2))))},e.prototype.getT=function(){var t=Math.cos;return 1-.17*t(this.degreesToRadians(this.HBarPrime-30))+.24*t(this.degreesToRadians(2*this.HBarPrime))+.32*t(this.degreesToRadians(3*this.HBarPrime+6))-.2*t(this.degreesToRadians(4*this.HBarPrime-63))},e.prototype.getHBarPrime=function(){return(0,Math.abs)(this.hPrime1-this.hPrime2)>180?(this.hPrime1+this.hPrime2+360)/2:(this.hPrime1+this.hPrime2)/2},e.prototype.getDeltahPrime=function(){var t=Math.abs;return 0===this.C1||0===this.C2?0:t(this.hPrime1-this.hPrime2)<=180?this.hPrime2-this.hPrime1:this.hPrime2<=this.hPrime1?this.hPrime2-this.hPrime1+360:this.hPrime2-this.hPrime1-360},e.prototype.gethPrime1=function(){return this._gethPrimeFn(this.x1.B,this.aPrime1)},e.prototype.gethPrime2=function(){return this._gethPrimeFn(this.x2.B,this.aPrime2)},e.prototype._gethPrimeFn=function(t,e){var i;return 0===t&&0===e?0:(i=this.radiansToDegrees(Math.atan2(t,e)))>=0?i:i+360},e.prototype.radiansToDegrees=function(t){return t*(180/Math.PI)},e.prototype.degreesToRadians=function(t){return t*(Math.PI/180)},t.exports=e},30:t=>{function e(t,e){this.x1=t,this.x2=e}e.prototype.getDeltaE=function(){var t=this.x1,e=this.x2;return Math.sqrt(Math.pow(e.L-t.L,2)+Math.pow(e.A-t.A,2)+Math.pow(e.B-t.B,2))},t.exports=e},794:t=>{function e(t,e,i){this.x1=t,this.x2=e,this.weights=i||{},this.weights.lightness=this.weights.lightness||1,this.weights.chroma=this.weights.chroma||1,this.weights.hue=this.weights.hue||1,1===this.weights.lightness?(this.weights.K1=.045,this.weights.K2=.015):(this.weights.K1=.048,this.weights.K2=.014)}e.prototype.getDeltaE=function(){var t=this.x1,e=this.x2,i=Math.sqrt,s=Math.pow;return i(s(this.calculateL(t,e),2)+s(this.calculateA(t,e),2)+s(this.calculateB(t,e),2))},e.prototype.calculateL=function(t,e){return(t.L-e.L)/this.weights.lightness},e.prototype.calculateA=function(t,e){var i=Math.sqrt,s=Math.pow,n=i(s(t.A,2)+s(t.B,2)),r=n-i(s(e.A,2)+s(e.B,2)),a=1+this.weights.K1*n;return r/(this.weights.chroma*a)},e.prototype.calculateB=function(t,e){var i=Math.sqrt,s=Math.pow,n=i(s(t.A,2)+s(t.B,2))-i(s(e.A,2)+s(e.B,2)),r=t.A-e.A,a=t.B-e.B,h=i(s(r,2)+s(a,2)-s(n,2))||0,o=i(s(t.A,2)+s(t.B,2));return h/(1+this.weights.K2*o)},t.exports=e},54:(t,e,i)=>{var s=i(30),n=i(794),r=i(267);function a(){}a.prototype.getDeltaE76=function(t,e){return new s(t,e).getDeltaE()},a.prototype.getDeltaE94=function(t,e){return new n(t,e).getDeltaE()},a.prototype.getDeltaE00=function(t,e){return new r(t,e).getDeltaE()},t.exports=new a}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var s={};i.d(s,{BX:()=>o,Gj:()=>n,GX:()=>h,Jh:()=>l,FR:()=>m,PZ:()=>b,Ni:()=>f,dT:()=>P,TY:()=>d,OH:()=>r,nA:()=>a,XK:()=>c});class n{constructor(t,e){this.method=t,this.message=e}}class r{constructor(){this._stopOnFail=!0,this._negateNext=!1}get shouldStopOnFail(){return this._stopOnFail}get not(){return this._negateNext=!0,this}stopOnFail(t){return this._stopOnFail=t,this}}class a{get valid(){var t,e;return 0==(null!==(e=null===(t=this.errors)||void 0===t?void 0:t.length)&&void 0!==e?e:0)}constructor(t){this.errors=null!=t?t:[]}}class h extends r{constructor(){super(...arguments),this._rules=[]}get rules(){return this._rules}validate(t){const e=[];for(const i of this._rules)i.method(t)||e.push(i.message);return new a(e)}lambda(t,e){if(this._negateNext){this._negateNext=!1;const i=e=>!t(e);this._rules.push(new n(i,e))}else this._rules.push(new n(t,e));return this}required(t){return this.lambda((t=>t.length>0),null!=t?t:this._negateNext?"Field should be empty":"Field is required")}equals(t,e){return this.lambda((e=>e===t),null!=e?e:this._negateNext?`Field must not equal '${t}'.`:`Field must equal '${t}'.`)}startsWith(t,e){return this.lambda((e=>e.startsWith(t)),null!=e?e:this._negateNext?`Field must not start with '${t}'.`:`Field must start with '${t}'.`)}endsWith(t,e){return this.lambda((e=>e.endsWith(t)),null!=e?e:this._negateNext?`Field must not end with '${t}'.`:`Field must end with '${t}'.`)}equalsRegex(t,e){return this.lambda((e=>t.test(e)),null!=e?e:this._negateNext?`Field must not match the pattern '${t.toString()}'.`:`Field must match the pattern '${t.toString()}'.`)}}class o{addValidationRule(){const t=new h;return this._ruleSets.push(t),t}constructor(t,e=!1){this._ruleSets=[],this.range=t,this.allowMultiline=e,this.id=crypto.randomUUID()}validate(t){const e=[];for(const i of this._ruleSets)for(const s of i.rules)if(!s.method(t)&&(e.push(s.message),i.shouldStopOnFail))break;return new a(e)}}class l{constructor(){this.handlers=[]}on(t){this.handlers.push(t)}off(t){this.handlers=this.handlers.filter((e=>e!==t))}trigger(t){this.handlers.slice(0).forEach((e=>e(t)))}expose(){return this}}var u=i(334);class c{constructor(t,e){this.content=t,this.rangeValues=e}}class d{get _model(){const t=this._editorInstance.getModel();if(null==t)throw"missing moddel";return t}get content(){return this._model.getValue()}get rangeValues(){let t={};return this._rangeRestrictions.length>0&&(t=this._model.getValueInEditableRanges()),t}constructor(t,e,i){this._rangeRestrictions=[],this.restrictions=[],this._previousRestrictionLength=0,this.onChangeContext=new l,this._editorInstance=monaco.editor.create(t,{value:e,language:i}),this._constrainedInstance=constrainedEditor(monaco),this._constrainedInstance.initializeIn(this._editorInstance);const s=u((()=>{this.onChangeContext.trigger(new c(this.content,this.rangeValues))}),200);this._model.onDidChangeContent(s)}changeRanges(){this._rangeRestrictions.length!==this._previousRestrictionLength&&(this._previousRestrictionLength>1&&this._constrainedInstance.removeRestrictionsIn(this._model),this._constrainedInstance.addRestrictionsTo(this._model,this._rangeRestrictions),this._previousRestrictionLength=this._rangeRestrictions.length)}setRanges(t){this._rangeRestrictions=t,this.changeRanges()}clearRanges(){this._rangeRestrictions.length=0,this.changeRanges()}}class m{constructor(t,e){this.onValidate=new l,this._editableFields=[],this._monacoEditorInstance=new d(t,e,"html"),this._monacoEditorInstance.onChangeContext.on((()=>{this.validate()}))}get content(){return this._monacoEditorInstance.content}setEditableFields(t){this._editableFields=t,this.editableFieldsChanged()}clearEditableFields(){this._editableFields.length=0,this.editableFieldsChanged()}validate(){return t=this,e=void 0,s=function*(){const t=this._monacoEditorInstance.rangeValues,e=this._editableFields.map((e=>{const i=t[e.id];if(null==i)throw"Unexpected missing value in ranges!";return e.validate(i)})).concat(yield this.validateExtend()).reduce(((t,e)=>new a(t.errors.concat(e.errors))));return this.onValidate.trigger(e),e},new((i=void 0)||(i=Promise))((function(n,r){function a(t){try{o(s.next(t))}catch(t){r(t)}}function h(t){try{o(s.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,h)}o((s=s.apply(t,e||[])).next())}));var t,e,i,s}editableFieldsChanged(){const t=[];this._editableFields.forEach((e=>{t.push({range:e.range,allowMultiline:e.allowMultiline,label:e.id})})),this._monacoEditorInstance.setRanges(t)}}function g(t){let e;if(t.startsWith("#")){let i=t.slice(1);if(3===i.length&&(i=i.split("").map((t=>t+t)).join("")),6!==i.length)throw new Error("Invalid hex color format");e=[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16)]}else{if(!t.startsWith("rgb"))throw new Error("Unsupported color format");{const i=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(!i)throw new Error("Invalid rgb/rgba format");e=[parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10)]}}e=[p(e[0],0,255),p(e[1],0,255),p(e[2],0,255)];const[i,s,n]=function(t,e,i){e/=255,i/=255;return[100*(.4124564*(t=(t/=255)>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3575761*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.1804375*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126729*t+.7151522*e+.072175*i),100*(.0193339*t+.119192*e+.9503041*i)]}(e[0],e[1],e[2]);return function(t,e,i){e/=100,i/=108.883;const s=t=>t>.008856?Math.cbrt(t):7.787*t+16/116,n=s(t/=95.047),r=s(e);return{L:116*r-16,A:500*(n-r),B:200*(r-s(i))}}(i,s,n)}function p(t,e,i){return Math.max(e,Math.min(i,t))}class f{constructor(t,e){this.method=t,this.message=e}}var w=i(54),x=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{o(s.next(t))}catch(t){r(t)}}function h(t){try{o(s.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,h)}o((s=s.apply(t,e||[])).next())}))};class P extends r{constructor(){super(...arguments),this._rules=[]}get rules(){return this._rules}lambda(t,e){if(this._negateNext){this._negateNext=!1;const i=(e,i)=>x(this,void 0,void 0,(function*(){return!(yield t(e,i))}));this._rules.push(new f(i,e))}else this._rules.push(new f(t,e));return this}required(t){return this.lambda((t=>t.length>0),null!=t?t:this._negateNext?"String should be empty":"String field is required")}isValidHTML(t){return this.lambda((t=>x(this,void 0,void 0,(function*(){let e={messages:Array};try{const i=yield fetch("https://validator.w3.org/nu/?out=json&level=error",{method:"POST",headers:{"Content-Type":"text/html; charset=UTF-8"},body:t});e=yield i.json()}catch(t){console.error("Error:",t)}return console.log(e.messages),0==e.messages.length}))),null!=t?t:this._negateNext?"Valid HTML":"Invalid HTML")}stringEquals(t,e){return this.lambda((e=>e===t),null!=e?e:this._negateNext?`String field must not equal '${t}'.`:`String field must equal '${t}'.`)}contentIncludes(t,e){return this.lambda((e=>e.includes(t)),null!=e?e:this._negateNext?`String field must not include '${t}'.`:`String field must include '${t}'.`)}iframeContains(t,e){return this.lambda(((e,i)=>null!==i.querySelector(t)),null!=e?e:this._negateNext?`IFrame must not contain an element matching '${t}'.`:`IFrame must contain an element matching '${t}'.`)}elementHasAttributeColor(t,e,i,s=50,n){return this.lambda(((n,r)=>{const a=g(i),h=r.querySelector(t);if(null==h)return!1;const o=window.getComputedStyle(h).getPropertyValue(e);if(""==o)return!1;const l=g(o),u=(0,w.getDeltaE00)(a,l);return console.log(u),u<=s}),null!=n?n:this._negateNext?`Element '${t}' exists, and has property '${e}' and color '${i}'.`:`Element '${t}' is missig, has no property '${e}' or does not have color '${i}'.`)}elementIncludesText(t,e,i){return this.lambda(((i,s)=>{const n=s.querySelector(t);return null!=n&&n.innerText.toLowerCase().includes(e.toLowerCase())}),null!=i?i:this._negateNext?`Element '${t}' exists and text matches '${e}'.`:`Element '${t}' is missig or text does not match '${e}'.`)}elementTextMatchesRegex(t,e,i){return this.lambda(((i,s)=>{const n=s.querySelector(t);return null!=n&&e.test(n.innerText)}),null!=i?i:this._negateNext?`Element '${t}' exists and text matches '${e}'.`:`Element '${t}' is missig or text does not match '${e}'.`)}stringMatchesRegex(t,e){return this.lambda((e=>t.test(e)),null!=e?e:this._negateNext?`String matches the pattern '${t}'.`:`String does not match the pattern '${t}'.`)}}var _=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function a(t){try{o(s.next(t))}catch(t){r(t)}}function h(t){try{o(s.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,h)}o((s=s.apply(t,e||[])).next())}))};class b extends m{constructor(t,e,i){if(super(t,e),this._ruleSets=[],null==i){const t=document.createElement("iframe");t.setAttribute("style","display: none"),document.body.appendChild(t),this.iframe=t}else this.iframe=i;this._monacoEditorInstance.onChangeContext.on((t=>{this.renderIframe()})),this.renderIframe()}addValidationRule(){const t=new P;return this._ruleSets.push(t),t}validateExtend(){return _(this,void 0,void 0,(function*(){this.renderIframe();const t=this.iframe.contentDocument;if(null==t)throw"contendDocument was null!";const e=[];for(const i of this._ruleSets)for(const s of i.rules)if(!(yield s.method(this.content,t))&&(e.push(s.message),i.shouldStopOnFail))break;return new a(e)}))}validateRule(t){return _(this,void 0,void 0,(function*(){this.renderIframe();const e=this.iframe.contentDocument;if(null==e)throw"contendDocument was null!";return yield t.method(this.content,e)}))}renderIframe(){if(null==this.iframe.srcdoc)throw"iframe was null!";const t=this.iframe.contentDocument;t.open(),t.write(this.content),t.close()}}var v=s.BX,y=s.Gj,C=s.GX,E=s.Jh,R=s.FR,B=s.PZ,M=s.Ni,F=s.dT,T=s.TY,I=s.OH,S=s.nA,$=s.XK;export{v as EditableField,y as EditableFieldValidationRule,C as EditableFieldValidationRuleSet,E as Event,R as Exercise,B as HtmlExcercise,M as HtmlValidationRule,F as HtmlValidationRuleSet,T as MonacoEditor,I as Validation,S as ValidationResult,$ as onChangeContextData};